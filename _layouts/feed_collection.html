---
layout: null
# Big thanks to - https://stackoverflow.com/a/42057699/2632107
---
{%- capture rss_workspace -%}
  {%- assign date_format = '%a, %d %b %Y %T %z' -%}
  {%- assign collection_name = page.collection_name | default: include.collection_name | default: nil -%}
  {%- assign target_collection = site[collection_name] -%}
  {%- assign collection_home = page.collection_home | default: collection_name -%}

  {%- assign this_time_stamp = page.date | date: '%s' -%}
  {%- assign latest_time_stamp = page.date | date: '%s' -%}
  {%- assign rss_items_has_output = False -%}


  {%- capture rss_items_workspace -%}
    {%- for post in target_collection -%}
      {%- assign post_synopsis = post.description | default: post.excerpt -%}
      {%- assign post_file_name = post.url | split: '/' | last | split: '.' | first -%}
      {%- if page.relative_path == post.relative_path -%}
        {%- continue -%}
      {%- elsif post_file_name == collection_name or post_file_name == 'index' -%}
        {%- continue -%}
      {%- else -%}
        {%- assign rss_items_has_output = True -%}
      {%- endif -%}

      <item>
        <title>{{- post.title -}}</title>
        <description>{{- post_synopsis | escape -}}</description>
        <link>{{- post.url | relative_url -}}</link>
        <guid isPermaLink="true">{{- post.url | absolute_url -}}</guid>
        <pubDate>{{- post.date | date: date_format -}}</pubDate>
      </item>

      {%- assign this_time_stamp = post.date | date: '%s' -%}
      {%- if latest_time_stamp < this_time_stamp -%}{%- comment -%}> # Work-around for syntax highlighting text-editors #{%- endcomment -%}
        {%- assign latest_time_stamp = this_time_stamp -%}
      {%- endif -%}
    {%- endfor -%}
  {%- endcapture -%}


  <?xml version="1.0" encoding="UTF-8" ?>
  <rss version="2.0">
    <channel>
      <title>{{- page.title | default: 'RSS Title' -}}</title>
      <link>{{- collection_home | absolute_url -}}</link>
      <lastBuildDate>{{- site.time | date: date_format -}}</lastBuildDate>
      <pubDate>{{- latest_time_stamp | date: date_format -}}</pubDate>
      <ttl>{{- page.time_to_live | default: '1800' -}}</ttl>
      {%- if rss_items_has_output == True -%}
        {{- rss_items_workspace | strip -}}{%- assign rss_items_workspace = nil -%}
      {%- endif -%}
    </channel>
  </rss>
{%- endcapture -%}{{- rss_workspace | strip -}}{%- assign rss_workspace = nil -%}
